# Dockerfile for the Admin Control Daemon
FROM dart:stable AS build

WORKDIR /app

# Copy pubspec files
COPY admin_control_daemon/pubspec.yaml ./
COPY admin_control_daemon/pubspec.lock ./

# Get dependencies
RUN dart pub get

# Copy the rest of the code
COPY admin_control_daemon .

# Build the admin daemon
RUN dart compile exe bin/server.dart -o /app/daemon

# Final stage - use the latest Docker CLI image (as of 2024-06)
FROM docker:24.0.9-cli

# Install any extra tools you need (e.g., curl, git)
RUN apk add --no-cache curl git

COPY --from=build /app/daemon /app/daemon

WORKDIR /opt/cloudtolocalllm

EXPOSE 9001

ENTRYPOINT ["/app/daemon"] 