# Dockerfile for the Tunnel Service (Flutter-based)
FROM ghcr.io/cirruslabs/flutter:latest AS build

WORKDIR /app

# Copy pubspec files and get dependencies
COPY pubspec.* ./
RUN flutter pub get

# Copy the rest of the app
COPY . .

# Build the Dart server/CLI app (bin/server.dart)
# Ensure this path is correct for your tunnel service entry point
RUN dart compile exe bin/server.dart -o /output/server 

# Final stage - minimal image to run the server
FROM scratch
COPY --from=build /output/server /app/server

# Expose port if needed by the tunnel service (e.g., 8080 or 3000)
EXPOSE 8080 

ENTRYPOINT ["/app/server"] 